<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Vertical datum conversions with PDAL | @gadomski</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Vertical datum conversions with PDAL" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="In order to match collected point cloud data to existing records, it is often necessary to convert the data from one coordinate system to another. Some types of conversions, e.g. basic reprojections, can be completely described by mathematical functions, making them relatively straightforward. Converting between vertical datums, however, can be more challenging." />
<meta property="og:description" content="In order to match collected point cloud data to existing records, it is often necessary to convert the data from one coordinate system to another. Some types of conversions, e.g. basic reprojections, can be completely described by mathematical functions, making them relatively straightforward. Converting between vertical datums, however, can be more challenging." />
<link rel="canonical" href="http://www.gadom.ski/2017/05/31/vdatum-with-pdal.html" />
<meta property="og:url" content="http://www.gadom.ski/2017/05/31/vdatum-with-pdal.html" />
<meta property="og:site_name" content="@gadomski" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-05-31T00:00:00-06:00" />
<script type="application/ld+json">
{"headline":"Vertical datum conversions with PDAL","url":"http://www.gadom.ski/2017/05/31/vdatum-with-pdal.html","datePublished":"2017-05-31T00:00:00-06:00","dateModified":"2017-05-31T00:00:00-06:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://www.gadom.ski/2017/05/31/vdatum-with-pdal.html"},"description":"In order to match collected point cloud data to existing records, it is often necessary to convert the data from one coordinate system to another. Some types of conversions, e.g. basic reprojections, can be completely described by mathematical functions, making them relatively straightforward. Converting between vertical datums, however, can be more challenging.","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://www.gadom.ski/feed.xml" title="@gadomski" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">@gadomski</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/publications/">Publications</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Vertical datum conversions with PDAL</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2017-05-31T00:00:00-06:00" itemprop="datePublished">May 31, 2017
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>In order to match collected point cloud data to existing records, it is often necessary to convert the data from one coordinate system to another.
Some types of conversions, e.g. basic reprojections, can be completely described by mathematical functions, making them relatively straightforward.
Converting between vertical datums, however, can be more challenging.</p>

<p>For a good introduction to vertical datums, <a href="https://vdatum.noaa.gov/docs/datums.html">NOAA has a quality tutorial</a>.
In this exercise, we are going to convert the vertical coordinates of a point cloud from a three-dimensional reference system, NAD 83 (1986), to a vertical datum, the North American Vertical Datum 1988 (NAVD 88).
NAVD 88 is based on the Earth’s gravity field, which varies in space (and in time) based upon rock density, crustal thickness, and a variety of other factors.
Earth’s gravity field can be expressed through a geoid, which is a (from the NOAA tutorial):</p>

<blockquote>
  <p>equipotential surface, defined in the Earth’s gravity field, which best fits, in a least squares sense, global mean sea level (MSL)</p>
</blockquote>

<p>In order to use <a href="https://www.pdal.io/">PDAL</a> to convert vertical coordinates to a new vertical datum, we’ll need to fetch the appropriate geoid.
PDAL uses <a href="http://proj4.org/">proj.4</a> under the hood, and proj.4 accepts geoid’s in NOAA VDatum’s <code class="language-plaintext highlighter-rouge">gtx</code> file format.
We can fetch the 12B geoid from the <a href="https://vdatum.noaa.gov/download.php">VDatum download website</a>.
Inside the 12B zipfile there is a file called <code class="language-plaintext highlighter-rouge">g2012b_conus.gtx</code>; this is the geoid for the Continental United States (CONUS).
We’ll use this file to convert our data.</p>

<p>For this example, we’ll convert data in NAD83 / UTM 18N, which has an <a href="http://www.epsg.org/">EPSG code</a> of <code class="language-plaintext highlighter-rouge">EPSG:26918</code> using the <code class="language-plaintext highlighter-rouge">pdal translate</code> subcommand.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pdal translate <span class="nt">-i</span> infile.las <span class="nt">-o</span> outfile.las <span class="se">\</span>
    <span class="nt">-f</span> reprojection <span class="se">\</span>
    <span class="nt">--filters</span>.reprojection.out_srs<span class="o">=</span><span class="s2">"+init=EPSG:26918 +geoidgrids=/path/to/vdatum/g2012b_conus.gtx"</span> <span class="se">\</span>
    <span class="nt">--writers</span>.las.a_srs<span class="o">=</span>EPSG:26918+5703
</code></pre></div></div>

<p>By providing the geoid path, PDAL will use proj.4 to convert each point to the NAVD88 vertical datum.
The <code class="language-plaintext highlighter-rouge">--writers.las.a_srs=EPSG:26918+5703</code> option sets the spatial reference system of the output file to the compound EPSG code <code class="language-plaintext highlighter-rouge">EPSG:26918+5703</code>.
<a href="http://spatialreference.org/ref/epsg/north-american-vertical-datum-of-1988-height/">EPSG:5703</a> is NAVD88.</p>

  </div><a class="u-url" href="/2017/05/31/vdatum-with-pdal.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">@gadomski</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">@gadomski</li><li><a class="u-email" href="mailto:pete@gadom.ski">pete@gadom.ski</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/gadomski"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">gadomski</span></a></li><li><a href="https://www.twitter.com/petegadomski"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">petegadomski</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>dogs and charts, mostly
</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
